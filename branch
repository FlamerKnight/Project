<%@ Page Language="C#" MasterPageFile="~/main.Master" AutoEventWireup="true" CodeBehind="ResetEmailorPassword.aspx.cs" Inherits="Project.ResetEmailorPassword" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
            <style>
            .overall{
                background-color: snow;
                width: 480px;
                height: 188px;
                border:1px solid #dadce0;
                border-radius:10px;
                margin:0 auto;
                box-shadow:5px;
           
                justify-content: center;
                align-items: center;
                height: auto;
            }

            .button{
                background-color: white;
                border:1px solid #dadce0;
                padding: 10px;
                display: inline-block;
                margin: 4px 2px;
                border-radius:10px;
                color:black;
                text-align: center;
                text-decoration: none;

            }

            .button a{
                color:black;
                text-align: center;
                text-decoration: none;
            }

            .rightcolumn {
                width: 408px;
                text-align:left;
            }
            .auto-style3 {
                width: 480px;
                height: 197px;
            }
            .leftcolumn {
                width: 562px;
                text-align: right;
                vertical-align:top;
        }
            .auto-style5 {
                font-size: 20px;
                height: 55px;
            }
            .BackButton {
                height: 29px;
            }
                .auto-style6 {
                    height: 32px;
                }
                .auto-style7 {
                    height: 24px;
                }
                .auto-style8 {
                    width: 562px;
                    text-align: right;
                    vertical-align: top;
                    height: 71px;
                }
                .auto-style9 {
                    width: 408px;
                    text-align: left;
                    height: 71px;
                }
                .answerEmailViewTextBox {
                    height: 23px;
                }
        </style>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">
        <asp:MultiView ID="MultiView1" runat="server">


            <asp:View ID="SuccessView" runat="server" >
                <asp:Label ID="Label1" runat="server" Text="Details Changed."></asp:Label>
                <br />
                <asp:Button ID="BacktoLoginButton" runat="server" Text="Back to Login" OnClick="BacktoLogin_Click" />
            </asp:View>
            <asp:View ID="EmailChangeView" runat="server">
                <table class="auto-style3">
            <tr>
                <td style="text-align:center;text-shadow:3px;"colspan="2" class="auto-style5">Change Email</td>
            </tr>
            <tr>
                <td class="leftcolumn">Email: </td>
                <td class="rightcolumn">
                    <asp:TextBox ID="emailChangeViewTextBox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="RequiredFieldValidator4" runat="server" ControlToValidate="emailChangeViewTextBox" ErrorMessage="Please enter your Email" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                    <br />

                </td>
            <tr>
                <td class="leftcolumn">&nbsp;</td>
                <td class="rightcolumn">
                    <asp:Button ID="EmailtoContinueButton" runat="server" Text="Continue" OnClick="EmailContinueButton_Click" />
                </td>
            </tr>
            </asp:View>
            <asp:View ID="OptionsView" runat="server">
                <asp:Button ID="forgotEmailButton" runat="server" Text="Forgot Email" OnClick="ForgotEmailButton_Click" />
                <br />
                <br />
                <br />

                <asp:Button ID="forgotPasswordButton" runat="server" Text="Forgot Password" OnClick="ForgotPasswordButton_Click" />
            </asp:View>
            <asp:View ID="ErrorView" runat="server">
                <asp:Label ID="ErrorLabel" runat="server" Text="Error, Incorrect or Unavailable information!"></asp:Label>
                <br />
                <br />
                <asp:Button ID="returnButton" runat="server" Text="Back" OnClick="ReturnButton_Click" />
                <asp:Button ID="okayButton" runat="server" Text="Edit" OnClick="OkayButton_Click" style="height: 29px; width: 42px" />
            </asp:View>
            <asp:View ID="EmailView" runat="server">
     <div class="overall">

        <table class="auto-style3">
            <tr>
                <td style="text-align:center;text-shadow:3px;"colspan="2" class="auto-style5">Email Recovery</td>
            </tr>
            <tr>
                <td class="leftcolumn">Name: </td>
                <td class="rightcolumn">
                    <asp:TextBox ID="nameEmailViewTextBox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px" OnTextChanged="getAnswer_Changed" AutoPostBack="True"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="nameDetailsValidator" runat="server" ControlToValidate="nameEmailViewTextBox" ErrorMessage="Please enter your Name" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                    <br />

                </td>
            </tr>
                        <tr>
                <td class="leftcolumn">Enter Password: </td>
                <td class="rightcolumn">
                    <asp:TextBox ID="passwordEmailViewTextBox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px" onTextChanged="getAnswer_Changed" AutoPostBack="True"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="RequiredFieldValidator1" runat="server" ControlToValidate="passwordEmailViewTextBox" ErrorMessage="Please enter your password" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                    <br />

                </td>
                    <tr>
                        <td align="center" colspan="2" class="auto-style7">Security Question: 
                        <asp:Label ID="QuestionEmailLabel" runat="server" Text=""></asp:Label>
                </td>
            </tr>
            <tr>
                <td class="auto-style8">Answer: </td>
                <td class="auto-style9">
                    <asp:TextBox ID="answerEmailViewTextBox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px" CssClass="answerEmailViewTextBox"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="RequiredFieldValidator2" runat="server" ControlToValidate="answerEmailViewTextBox" ErrorMessage="Please enter your Security Question!" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                    <br />

                </td>
            </tr>
            <tr>
                <td class="leftcolumn">&nbsp;</td>
                <td class="rightcolumn">
                    <asp:Button ID="continueButton" runat="server" Text="Continue" OnClick="ContinueButton_Click" />
                </td>
            </tr>
            </asp:View>
            <asp:View ID="PasswordChangeView" runat="server">
                        <table cellpadding="1" cellspacing="0" style="border-collapse:collapse;">
                            <tr>
                                <td>
                                    <table cellpadding="0">
                                        <tr>
                                            <td align="center" colspan="2">Change Your Password</td>
                                        </tr>
                                        <tr>
                                            <td align="right">
                                                <asp:Label ID="CurrentPasswordLabel" runat="server" AssociatedControlID="CurrentPassword">Password:</asp:Label>
                                            </td>
                                            <td>
                                                <asp:TextBox ID="CurrentPassword" runat="server" TextMode="Password"></asp:TextBox>
                                                <asp:RequiredFieldValidator ID="CurrentPasswordRequired" runat="server" ControlToValidate="CurrentPassword" ErrorMessage="Password is required." ToolTip="Password is required." ValidationGroup="ChangePassword1">*</asp:RequiredFieldValidator>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="right">
                                                <asp:Label ID="NewPasswordLabel" runat="server" AssociatedControlID="NewPassword">New Password:</asp:Label>
                                            </td>
                                            <td>
                                                <asp:TextBox ID="NewPassword" runat="server" TextMode="Password"></asp:TextBox>
                                                <asp:RequiredFieldValidator ID="NewPasswordRequired" runat="server" ControlToValidate="NewPassword" ErrorMessage="New Password is required." ToolTip="New Password is required." ValidationGroup="ChangePassword1">*</asp:RequiredFieldValidator>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="right">
                                                <asp:Label ID="ConfirmNewPasswordLabel" runat="server" AssociatedControlID="ConfirmNewPassword">Confirm New Password:</asp:Label>
                                            </td>
                                            <td>
                                                <asp:TextBox ID="ConfirmNewPassword" runat="server" TextMode="Password"></asp:TextBox>
                                                <asp:RequiredFieldValidator ID="ConfirmNewPasswordRequired" runat="server" ControlToValidate="ConfirmNewPassword" ErrorMessage="Confirm New Password is required." ToolTip="Confirm New Password is required." ValidationGroup="ChangePassword1">*</asp:RequiredFieldValidator>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="center" colspan="2">
                                                <asp:CompareValidator ID="NewPasswordCompare" runat="server" ControlToCompare="NewPassword" ControlToValidate="ConfirmNewPassword" Display="Dynamic" ErrorMessage="The Confirm New Password must match the New Password entry." ValidationGroup="ChangePassword1"></asp:CompareValidator>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="center" colspan="2" style="color:Red;">
                                                <asp:Literal ID="FailureText" runat="server" EnableViewState="False"></asp:Literal>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="right">
                                                <asp:Button ID="ChangePasswordPushButton" runat="server" CommandName="ChangePassword" Text="Change Password" OnClick="ChangePasswordPushButton_Click" />
                                            </td>
                                            <td>
                                                <asp:Button ID="CancelPushButton" runat="server" CausesValidation="False" CommandName="Cancel" Text="Cancel" OnClick="CancelPushButton_Click" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                </asp:ChangePassword>
            </asp:View>
            <asp:View ID="PasswordView" runat="server">
                        <table cellpadding="1" cellspacing="0" style="border-collapse:collapse;">
                            <tr>
                                <td>
                                    <table cellpadding="0">
                                        <tr>
                                            <td align="center" colspan="2">Forgot Your Password?</td>
                                        </tr>
                                        <tr>
                                            <td align="center" colspan="2">Enter your Password and security question to change your password.</td>
                                        </tr>
                                        <tr>
                                            <td align="right" class="auto-style6">
                                                <asp:Label ID="EmailLabel" runat="server"> Email Detail:</asp:Label>
                                            </td>
                                            <td class="auto-style6">
                                                <asp:TextBox ID="emailDetailsTextBox" runat="server" CssClass="emailDetailsTextBox" onTextChanged="EmailDetailsChanged_Changed" AutoPostBack="True"></asp:TextBox>
                                                <asp:RequiredFieldValidator ID="EmailRequired" runat="server" ControlToValidate="EmailDetailsTextBox" ErrorMessage="Your email is required." ToolTip="Email is required." ValidationGroup="PasswordRecovery1">*</asp:RequiredFieldValidator>
                                            </td>

                                        </tr>
                                                                                <tr>
                                            <td align="center" colspan="2" class="auto-style7">Security Question: 
                                                <asp:Label ID="SecurityQnLabel" runat="server" Text="Label"></asp:Label>
                                                                                    </td>
                                        </tr>
                                        <tr>
                                            <td align="right">
                                                <asp:Label ID="answerLabel" runat="server"> Answer:</asp:Label>
                                            </td>
                                            <td>
                                                <asp:TextBox ID="AnswerTextBox" runat="server"></asp:TextBox>
                                                <asp:RequiredFieldValidator ID="RequiredFieldValidator3" runat="server" ControlToValidate="AnswerTextBox" ErrorMessage="Your Answer is required." ToolTip="Answer is required." ValidationGroup="PasswordRecovery1">*</asp:RequiredFieldValidator>
                                            </td>

                                        </tr>
                                        <tr>
                                            <td align="center" colspan="2" style="color:Red;">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td align="right" colspan="2">
                                                <asp:Button ID="PasswordFormSubmitButton" runat="server" CommandName="Submit" OnClick="PasswordFormSubmitButton_Click" Text="Submit" ValidationGroup="PasswordRecovery1" />
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                </asp:PasswordRecovery>
            </asp:View>
        </asp:MultiView>
  </asp:Content>

using Project.App_Code;
using System;
using System.Collections.Generic;
using System.Data.SqlClient;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace Project
{
    public partial class ResetEmailorPassword : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            MultiView1.SetActiveView(OptionsView);
        }

        protected void ForgotEmailButton_Click(object sender, EventArgs e)
        {
            MultiView1.SetActiveView(EmailView);
        }


        protected void ForgotPasswordButton_Click(object sender, EventArgs e)
        {
            MultiView1.SetActiveView(PasswordView);
        }

        protected void ReturnButton_Click(object sender, EventArgs e)
        {

        }
        protected void BacktoLogin_Click(object sender, EventArgs e)
        {
            Response.Redirect("Login.aspx");
            MultiView1.Visible = false;
        }
        protected void EmailContinueButton_Click(object sender, EventArgs e)
        {
            int temp;
            string sqlcmd = $"update shopper set Email = '{emailChangeViewTextBox.Text}' where passwd = '{Session["passwd"]}'";
            DatabaseMgmt dbObj = new DatabaseMgmt();
            temp = dbObj.ExecuteNonQuery(sqlcmd);

            MultiView1.SetActiveView(SuccessView);
        }

        protected void OkayButton_Click(object sender, EventArgs e)
        {

        }
        protected void ContinueButton_Click(object sender, EventArgs e)
        {
            string Question;

            //Read Database
            DatabaseMgmt dbObj = new DatabaseMgmt();
            SqlDataReader dR;
            dbObj.Connect();

            string strSqlCmd;
            strSqlCmd = $"select SecurityQn, QnAnswer, Email, ShopperID from Shopper where Name='{nameEmailViewTextBox.Text}'";

            dR = dbObj.ExecuteSelect(strSqlCmd);
            if (dR.Read())
            {
                Question = dR["QnAnswer"].ToString();
                if (answerEmailViewTextBox.Text == Question)
                {
                    MultiView1.SetActiveView(EmailChangeView);
                    Session["name"] = nameEmailViewTextBox.Text;
                    Session["passwd"] = passwordEmailViewTextBox.Text;

                }
                else
                {
                    MultiView1.SetActiveView(EmailView);
                    QuestionEmailLabel.Text = "Wrong Answer!";
                }
            }
            else
            {
                MultiView1.SetActiveView(EmailView);
                QuestionEmailLabel.Text = "No Account found!";
            }

        }

        protected void EmailDetailsChanged_Changed(object sender, EventArgs e)
        {
            MultiView1.SetActiveView(PasswordView);
            object returnVal;
            string Name;

            //Read Database
            DatabaseMgmt dbObj = new DatabaseMgmt();
            SqlDataReader dR;
            dbObj.Connect();


            string strSqlCmd;
            strSqlCmd = $"select SecurityQn, ShopperID from Shopper where Email='{emailDetailsTextBox.Text}'";

            dR = dbObj.ExecuteSelect(strSqlCmd);
            if (dR.Read())
            {
                SecurityQnLabel.Text = dR["SecurityQn"].ToString();

            }
            else
            {
                SecurityQnLabel.Text = "No Account found!";
            }
        }

        protected void PasswordFormSubmitButton_Click(object sender, EventArgs e)
        {
            string Question;

            //Read Database
            DatabaseMgmt dbObj = new DatabaseMgmt();
            SqlDataReader dR;
            dbObj.Connect();


            string strSqlCmd;
            strSqlCmd = $"select Name, ShopperID, SecurityQn, QnAnswer from Shopper where Email='{emailDetailsTextBox.Text}'";

            dR = dbObj.ExecuteSelect(strSqlCmd);
            if (dR.Read())
            {
                Question = dR["QnAnswer"].ToString();

                if (AnswerTextBox.Text == Question)
                {
                    MultiView1.SetActiveView(PasswordChangeView);
                    Session["email"] = emailDetailsTextBox.Text;
                }
                else
                {
                    SecurityQnLabel.Text = "Wrong";
                    MultiView1.SetActiveView(PasswordView);

                }

            }
            else
            {
                SecurityQnLabel.Text = "No Account found!";
                MultiView1.SetActiveView(PasswordView);
            }
        }

        protected void ChangePasswordPushButton_Click(object sender, EventArgs e)
        {
            int temp;
            string sqlcmd = $"update shopper set passwd = '{ConfirmNewPassword.Text}' where Email = '{Session["email"]}'";
            DatabaseMgmt dbObj = new DatabaseMgmt();
            temp = dbObj.ExecuteNonQuery(sqlcmd);

            MultiView1.SetActiveView(SuccessView);
        }

        protected void CancelPushButton_Click(object sender, EventArgs e)
        {
            MultiView1.SetActiveView(OptionsView);
        }


        protected void getAnswer_Changed(object sender, EventArgs e) {
            string Question;

            //Read Database
            DatabaseMgmt dbObj = new DatabaseMgmt();
            SqlDataReader dR;
            dbObj.Connect();


            string strSqlCmd;
            strSqlCmd = $"select Name, ShopperID, SecurityQn, QnAnswer from Shopper where Name='{nameEmailViewTextBox.Text}' and passwd = '{passwordEmailViewTextBox.Text}'";

            dR = dbObj.ExecuteSelect(strSqlCmd);
            if (dR.Read())
            {
                MultiView1.SetActiveView(EmailView);
                Question = dR["SecurityQn"].ToString();
                QuestionEmailLabel.Text = Question;
            }
            else {
                QuestionEmailLabel.Text = "No Account found";
                MultiView1.SetActiveView(EmailView);
            }
        }
    }
}
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated. 
// </auto-generated>
//------------------------------------------------------------------------------

namespace Project
{


    public partial class ResetEmailorPassword
    {

        /// <summary>
        /// MultiView1 control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.MultiView MultiView1;

        /// <summary>
        /// SuccessView control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.View SuccessView;

        /// <summary>
        /// Label1 control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label Label1;

        /// <summary>
        /// BacktoLoginButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button BacktoLoginButton;

        /// <summary>
        /// EmailChangeView control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.View EmailChangeView;

        /// <summary>
        /// emailChangeViewTextBox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox emailChangeViewTextBox;

        /// <summary>
        /// RequiredFieldValidator4 control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator RequiredFieldValidator4;

        /// <summary>
        /// EmailtoContinueButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button EmailtoContinueButton;

        /// <summary>
        /// OptionsView control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.View OptionsView;

        /// <summary>
        /// forgotEmailButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button forgotEmailButton;

        /// <summary>
        /// forgotPasswordButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button forgotPasswordButton;

        /// <summary>
        /// ErrorView control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.View ErrorView;

        /// <summary>
        /// ErrorLabel control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label ErrorLabel;

        /// <summary>
        /// returnButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button returnButton;

        /// <summary>
        /// okayButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button okayButton;

        /// <summary>
        /// EmailView control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.View EmailView;

        /// <summary>
        /// nameEmailViewTextBox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox nameEmailViewTextBox;

        /// <summary>
        /// nameDetailsValidator control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator nameDetailsValidator;

        /// <summary>
        /// passwordEmailViewTextBox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox passwordEmailViewTextBox;

        /// <summary>
        /// RequiredFieldValidator1 control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator RequiredFieldValidator1;

        /// <summary>
        /// QuestionEmailLabel control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label QuestionEmailLabel;

        /// <summary>
        /// answerEmailViewTextBox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox answerEmailViewTextBox;

        /// <summary>
        /// RequiredFieldValidator2 control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator RequiredFieldValidator2;

        /// <summary>
        /// continueButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button continueButton;

        /// <summary>
        /// PasswordChangeView control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.View PasswordChangeView;

        /// <summary>
        /// CurrentPasswordLabel control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label CurrentPasswordLabel;

        /// <summary>
        /// CurrentPassword control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox CurrentPassword;

        /// <summary>
        /// CurrentPasswordRequired control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator CurrentPasswordRequired;

        /// <summary>
        /// NewPasswordLabel control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label NewPasswordLabel;

        /// <summary>
        /// NewPassword control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox NewPassword;

        /// <summary>
        /// NewPasswordRequired control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator NewPasswordRequired;

        /// <summary>
        /// ConfirmNewPasswordLabel control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label ConfirmNewPasswordLabel;

        /// <summary>
        /// ConfirmNewPassword control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox ConfirmNewPassword;

        /// <summary>
        /// ConfirmNewPasswordRequired control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator ConfirmNewPasswordRequired;

        /// <summary>
        /// NewPasswordCompare control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.CompareValidator NewPasswordCompare;

        /// <summary>
        /// FailureText control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Literal FailureText;

        /// <summary>
        /// ChangePasswordPushButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button ChangePasswordPushButton;

        /// <summary>
        /// CancelPushButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button CancelPushButton;

        /// <summary>
        /// PasswordView control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.View PasswordView;

        /// <summary>
        /// EmailLabel control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label EmailLabel;

        /// <summary>
        /// emailDetailsTextBox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox emailDetailsTextBox;

        /// <summary>
        /// EmailRequired control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator EmailRequired;

        /// <summary>
        /// SecurityQnLabel control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label SecurityQnLabel;

        /// <summary>
        /// answerLabel control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label answerLabel;

        /// <summary>
        /// AnswerTextBox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox AnswerTextBox;

        /// <summary>
        /// RequiredFieldValidator3 control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator RequiredFieldValidator3;

        /// <summary>
        /// PasswordFormSubmitButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Button PasswordFormSubmitButton;
    }
}

<%@ Page Title="" Language="C#" MasterPageFile="~/main.Master" AutoEventWireup="true" CodeBehind="Register.aspx.cs" Inherits="Project.Register" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
        <style>
            .overall{
                background-color: snow;
                width: 480px;
                height: 188px;
                border:1px solid #dadce0;
                border-radius:10px;
                margin:0 auto;
                box-shadow:5px;
           
                justify-content: center;
                align-items: center;
                height: auto;
            }

            .button{
                background-color: white;
                border:1px solid #dadce0;
                padding: 10px;
                display: inline-block;
                margin: 4px 2px;
                border-radius:10px;
                color:black;
                text-align: center;
                text-decoration: none;

            }

            .button a{
                color:black;
                text-align: center;
                text-decoration: none;
            }

            .rightcolumn {
                width: 408px;
                text-align:left;
            }
            .auto-style2 {
                text-align:center;
            }
            .auto-style3 {
                width: 480px;
                height: 197px;
            }
            .leftcolumn {
                width: 562px;
                text-align: right;
                vertical-align:top;
        }
            .auto-style5 {
                font-size: 20px;
                height: 55px;
            }
            .auto-style6 {
                width: 562px;
                text-align: right;
                vertical-align: top;
                height: 43px;
            }
            .auto-style7 {
                width: 408px;
                text-align: left;
                height: 43px;
            }
            .auto-style8 {
                width: 562px;
                text-align: right;
                vertical-align: top;
                height: 24px;
            }
            .auto-style9 {
                width: 408px;
                text-align: left;
                height: 24px;
            }
            .auto-style10 {
                text-align: right;
                vertical-align: top;
                height: 24px;
            }
        </style>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <div class="overall">

        <table class="auto-style3">
            <tr>
                <td style="text-align:center;text-shadow:3px;"colspan="2" class="auto-style5">Registration</td>
            </tr>
            <tr>
                <td class="leftcolumn">Name</td>
                <td class="rightcolumn">
                    <asp:TextBox ID="nameTextBox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="nameValidator" runat="server" ControlToValidate="nameTextBox" ErrorMessage="Please enter your Name" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                    <br />
                </td>
            </tr>
            <tr>
                <td class="leftcolumn">Password</td>
                <td class="rightcolumn">
                    <asp:TextBox ID="pswTextBox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px" TextMode="Password"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="pswValidator" runat="server" ControlToValidate="pswTextBox" ErrorMessage="Please enter your password" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                </td>
            </tr>
            <tr>
                <td class="auto-style6">
                    Retype Password</td>
                <td class="auto-style7">
                    <asp:TextBox ID="pswReTextbox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px" TextMode="Password"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="pswReValidator" runat="server" ControlToValidate="pswReTextBox" ErrorMessage="Please enter your password" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                    <br />
                    <asp:CompareValidator ID="passwordCValidator" runat="server" ControlToCompare="pswTextBox" ControlToValidate="pswReTextbox" ErrorMessage="CompareValidator"></asp:CompareValidator>
                    </td>
            </tr>
            <tr>
                <td class="leftcolumn">
                    Address</td>
                <td class="rightcolumn">
                    <asp:TextBox ID="addressTextbox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="addressValidator" runat="server" ControlToValidate="addressTextbox" ErrorMessage="Please enter your password" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                </td>
            </tr>
            <tr>
                <td class="auto-style8">
                    Email</td>
                <td class="auto-style9">
                    <asp:TextBox ID="emailTextbox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="emailValidator" runat="server" ControlToValidate="emailTextbox" ErrorMessage="Please enter your password" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                    <br />
                    <asp:RegularExpressionValidator ID="RegularExpressionValidator1" runat="server" ControlToValidate="emailTextBox" ErrorMessage="Please enter a valid Email" ValidationExpression="\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*"></asp:RegularExpressionValidator>
                    </td>
            </tr>
            <tr>
                <td class="auto-style8">
                    Phone:</td>
                <td class="auto-style9">
                    <asp:TextBox ID="phoneTextbox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="phoneValidator" runat="server" ControlToValidate="phoneTextbox" ErrorMessage="Please enter your password" ForeColor="#FF5050"></asp:RequiredFieldValidator>
                </td>
            </tr>
                   <tr>
                <td class="auto-style8">
                    Security Question:</td>
                <td class="auto-style9">

                    <asp:DropDownList ID="DropDownList1" runat="server">
                        <asp:ListItem Selected="True">What is your pet name?</asp:ListItem>
                        <asp:ListItem>Where did your parents meet?</asp:ListItem>
                        <asp:ListItem>test</asp:ListItem>
                    </asp:DropDownList>

                    <asp:TextBox ID="SecurityTextBox" runat="server" BorderColor="#CCCCCC" BorderStyle="Solid" BorderWidth="1px"></asp:TextBox>
                    <br />
                    <asp:RequiredFieldValidator ID="RequiredFieldValidator1" runat="server" ControlToValidate="SecurityTextbox" ErrorMessage="Please enter your answer." ForeColor="#FF5050"></asp:RequiredFieldValidator>
                </td>
            </tr>
            <tr>
                <td style="text-align:center" class="auto-style10" colspan="2">
                    <asp:Label ID="msgLabel" runat="server"></asp:Label>
                </td>
            </tr>
            <tr>
                <td class="auto-style2" colspan="2">
                        <asp:LinkButton CSSClass="button" ID="RegisterButton" runat="server" OnClick="RegisterButton_Click">Register</asp:LinkButton>
                </td>
            </tr>
        </table>

    </div>

</asp:Content>

using Project.App_Code;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace Project
{
    public partial class Register : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {

        }

        protected void RegisterButton_Click(object sender, EventArgs e)
        {
            if (Page.IsValid) {
                object returnVal;
                string strName, strAddress, strPhone, strPassword, strEmail, strQuestion, strAnswer;

                int intShopperID = 0;

                strName = nameTextBox.Text;
                strAddress = addressTextbox.Text;
                strPhone = phoneTextbox.Text;
                strEmail = emailTextbox.Text;
                strPassword = pswTextBox.Text.Trim();
               strQuestion = DropDownList1.SelectedValue;
                strAnswer = SecurityTextBox.Text;

                DatabaseMgmt dbObj = new DatabaseMgmt();
                
                string strSqlCmd;
                strSqlCmd = $"select ShopperID from Shopper where Email='{strEmail}'";

                if ((returnVal = (object)dbObj.ExecuteScalar(strSqlCmd)) != null) {
                    intShopperID = Convert.ToInt32(returnVal);
                } else {
                    intShopperID = 0;
                }

                if(intShopperID == 0) {
                    strSqlCmd = $"Insert into Shopper(Name, Address,Phone, Email, Passwd, SecurityQn, QnAnswer) VALUES ('{strName}','{strAddress}'," +
                        $"'{strPhone}','{strEmail}','{strPassword}','{strQuestion}','{strAnswer}')";
                    dbObj.ExecuteNonQuery(strSqlCmd);

                    strSqlCmd = $"select MAX(ShopperID) From Shopper";
                    if ((returnVal = (object)dbObj.ExecuteScalar(strSqlCmd)) != null) {
                        intShopperID = Convert.ToInt32(returnVal);
                    } else {
                        intShopperID = 0;
                    }

                    Session["ShopperID"] = intShopperID;
                    Session["Name"] = strName;
                    Session["Address"] = strAddress;
                    Session["Phone"] = strPhone;
                    Session["Email"] = strEmail;
                    Session["ProfileRetrived"] = 1;
                    msgLabel.Text = "Registration Successful";
                } else {
                    msgLabel.Text = "Please select another email to register";
                }
            } 
        }
    }
}
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated. 
// </auto-generated>
//------------------------------------------------------------------------------

namespace Project
{


    public partial class Register
    {

        /// <summary>
        /// nameTextBox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox nameTextBox;

        /// <summary>
        /// nameValidator control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator nameValidator;

        /// <summary>
        /// pswTextBox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox pswTextBox;

        /// <summary>
        /// pswValidator control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator pswValidator;

        /// <summary>
        /// pswReTextbox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox pswReTextbox;

        /// <summary>
        /// pswReValidator control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator pswReValidator;

        /// <summary>
        /// passwordCValidator control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.CompareValidator passwordCValidator;

        /// <summary>
        /// addressTextbox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox addressTextbox;

        /// <summary>
        /// addressValidator control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator addressValidator;

        /// <summary>
        /// emailTextbox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox emailTextbox;

        /// <summary>
        /// emailValidator control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator emailValidator;

        /// <summary>
        /// RegularExpressionValidator1 control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RegularExpressionValidator RegularExpressionValidator1;

        /// <summary>
        /// phoneTextbox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox phoneTextbox;

        /// <summary>
        /// phoneValidator control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator phoneValidator;

        /// <summary>
        /// DropDownList1 control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.DropDownList DropDownList1;

        /// <summary>
        /// SecurityTextBox control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.TextBox SecurityTextBox;

        /// <summary>
        /// RequiredFieldValidator1 control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.RequiredFieldValidator RequiredFieldValidator1;

        /// <summary>
        /// msgLabel control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.Label msgLabel;

        /// <summary>
        /// RegisterButton control.
        /// </summary>
        /// <remarks>
        /// Auto-generated field.
        /// To modify move field declaration from designer file to code-behind file.
        /// </remarks>
        protected global::System.Web.UI.WebControls.LinkButton RegisterButton;
    }
}
